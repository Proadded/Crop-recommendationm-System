<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart Crop Advisor</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
     :root {
  --primary-color: #4CAF50;
  --primary-light: #66BB6A;
  --primary-dark: #2E7D32;
  --accent-color: #81C784;
  --text-color: #333;
  --background-color: #F0F4F0;
  --glass-bg: rgba(255, 255, 255, 0.15);
  --glass-border: rgba(255, 255, 255, 0.3);
  --glass-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)),
              url('https://images.unsplash.com/photo-1523741543316-beb7fc7023d8') no-repeat center center fixed;
  background-size: cover;
  color: white;
  line-height: 1.6;
  animation: fadeIn 2s ease-in-out;
  min-height: 100vh;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.main-container {
  background: var(--glass-bg);
  border-radius: 20px;
  box-shadow: var(--glass-shadow);
  padding: 40px;
  margin-top: 50px;
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  transition: all 0.4s ease;
}

.main-container:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.form-header h1 {
  color: white;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  animation: slideIn 1s ease-in-out;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  font-weight: 600;
  letter-spacing: 1px;
}

@keyframes slideIn {
  from { transform: translateX(-100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Enhanced Form Elements */
.form-label {
  color: #f0f0f0;
  font-weight: 500;
  display: block;
  margin-bottom: 8px;
  transition: transform 0.3s ease;
}

.form-group:focus-within .form-label {
  transform: translateY(-2px);
  color: var(--primary-light);
}

.form-control {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 12px 15px;
  width: 100%;
  transition: all 0.3s ease;
  font-size: 16px;
}

.form-control:focus {
  background: rgba(255, 255, 255, 0.25);
  color: white;
  border-color: var(--primary-color);
  box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
  outline: none;
  transform: translateY(-2px);
}

.form-control::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

/* Enhanced Buttons */
.btn-primary {
  background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
  color: white;
  border: none;
  border-radius: 8px;
  padding: 14px 28px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  letter-spacing: 0.5px;
  transition: all 0.4s ease;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  position: relative;
  overflow: hidden;
}

.btn-primary:hover {
  background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
  transform: translateY(-5px);
  box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
}

.btn-primary:active {
  transform: translateY(-2px);
}

.btn-primary::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 150%;
  height: 150%;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  transition: transform 0.5s, opacity 0.5s;
}

.btn-primary:hover::after {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

/* Enhanced Crop Input Group */
.crop-input-group {
  background: rgba(129, 199, 132, 0.15);
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(129, 199, 132, 0.3);
  transition: all 0.3s ease;
}

.crop-input-group:hover {
  background: rgba(129, 199, 132, 0.2);
  transform: translateY(-5px);
}

/* Enhanced Weather Widget */
.weather-widget {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
  border-radius: 18px;
  padding: 30px;
  margin-bottom: 25px;
  text-align: center;
  backdrop-filter: blur(15px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.weather-widget:hover {
  transform: translateY(-7px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.weather-widget::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--primary-color));
  animation: gradientShift 3s infinite linear;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.weather-search {
  display: flex;
  margin-bottom: 20px;
}

.weather-search input {
  flex-grow: 1;
  margin-right: 10px;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 12px 15px;
  transition: all 0.3s ease;
  font-size: 16px;
}

.weather-search input:focus {
  background: rgba(255, 255, 255, 0.3);
  border-color: var(--primary-color);
  box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
  outline: none;
}

.weather-search button {
  background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0 20px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.weather-search button:hover {
  background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
  transform: translateX(3px);
}

.weather-icon {
  font-size: 4rem;
  margin: 10px 0 20px;
  animation: pulse 2s infinite;
  color: #fff;
  text-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); opacity: 0.9; }
}

.weather-details {
  color: #f8f8f8;
  margin-top: 15px;
}

.weather-temp {
  font-size: 3rem;
  font-weight: 600;
  margin-bottom: 10px;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.weather-desc {
  font-size: 1.2rem;
  margin-bottom: 15px;
  text-transform: capitalize;
}

.weather-info {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 20px;
}

.weather-info-item {
  background: rgba(255, 255, 255, 0.1);
  padding: 10px;
  border-radius: 10px;
}

.weather-info-value {
  font-size: 1.2rem;
  font-weight: 500;
}

.agricultural-advice {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  color: #f0f0f0;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.agricultural-advice::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: var(--primary-color);
}

/* Enhanced AI Assistant */
.ai-assistant {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 1000;
}

.ai-button {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.ai-button::before {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  border-radius: 50%;
  opacity: 0.7;
  animation: pulse-ring 2s linear infinite;
}

@keyframes pulse-ring {
  0% { transform: scale(0.95); opacity: 0.7; }
  50% { transform: scale(1.1); opacity: 0.3; }
  100% { transform: scale(0.95); opacity: 0.7; }
}

.ai-button i {
  font-size: 28px;
  z-index: 2;
}

.ai-button:hover {
  transform: scale(1.1);
}

.ai-chat-window {
  position: fixed;
  bottom: 120px;
  right: 30px;
  width: 380px;
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
  display: none;
  z-index: 1001;
  overflow: hidden;
  animation: slideUp 0.5s ease-out;
}

@keyframes slideUp {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.ai-chat-header {
  background: linear-gradient(to right, var(--primary-dark), var(--primary-color));
  color: white;
  padding: 18px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}

.ai-chat-header h4 {
  font-weight: 600;
  font-size: 18px;
  margin: 0;
}

.ai-chat-header button {
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 20px;
}

.ai-chat-body {
  height: 400px;
  overflow-y: auto;
  padding: 25px;
  background-color: #f8f8f8;
  display: flex;
  flex-direction: column;
}

.ai-message {
  margin-bottom: 20px;
  padding: 12px 18px;
  border-radius: 18px;
  max-width: 85%;
  line-height: 1.5;
  position: relative;
  word-wrap: break-word;
  animation: fadeInUp 0.5s ease-in-out;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.ai-message.bot {
  background-color: #E8F5E9;
  color: #333;
  border-bottom-left-radius: 5px;
  align-self: flex-start;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.ai-message.user {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  border-bottom-right-radius: 5px;
  align-self: flex-end;
  margin-left: auto;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

/* Message typing animation */
.typing-indicator {
  display: flex;
  padding: 12px 18px;
  background: #E8F5E9;
  border-radius: 18px;
  border-bottom-left-radius: 5px;
  align-self: flex-start;
  margin-bottom: 20px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.typing-indicator span {
  height: 8px;
  width: 8px;
  background: var(--primary-color);
  border-radius: 50%;
  display: inline-block;
  margin: 0 2px;
  opacity: 0.4;
}

.typing-indicator span:nth-child(1) {
  animation: blink 1s infinite 0.1s;
}

.typing-indicator span:nth-child(2) {
  animation: blink 1s infinite 0.3s;
}

.typing-indicator span:nth-child(3) {
  animation: blink 1s infinite 0.5s;
}

@keyframes blink {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.ai-chat-input {
  display: flex;
  padding: 18px;
  background-color: white;
  border-top: 1px solid #eee;
}

.ai-chat-input input {
  flex-grow: 1;
  padding: 12px 15px;
  border: 2px solid #eaeaea;
  border-radius: 30px;
  margin-right: 12px;
  font-size: 15px;
  transition: all 0.3s ease;
}

.ai-chat-input input:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
  outline: none;
}

.ai-chat-input button {
  background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
  color: white;
  border: none;
  border-radius: 50%;
  width: 45px;
  height: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.ai-chat-input button:hover {
  transform: scale(1.1);
  background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
}

@media (max-width: 768px) {
  .main-container {
    padding: 25px;
    margin: 20px 15px;
  }

  .ai-chat-window {
    width: 95%;
    right: 2.5%;
    bottom: 90px;
  }

  .weather-info {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .weather-info {
    grid-template-columns: 1fr;
  }
}
    </style>

  </head>
  <body>
    <div class="container">
      <div class="main-container">
        <div class="row">
          <div class="col-md-4">
            <div class="weather-widget">
              <div class="weather-search">
                <input type="text" id="citySearch" placeholder="Enter city name" class="form-control">
                <button onclick="searchWeather()" class="btn btn-primary">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <div id="weatherInfo">
                <div class="weather-icon">
                  <i class="fas fa-cloud-sun"></i>
                </div>
                <h3 id="locationName">Loading...</h3>
                <div class="weather-details">
                  <p id="temperature">Temperature: -- °C</p>
                  <p id="weatherCondition">Condition: --</p>
                  <p id="humidity">Humidity: --%</p>
                  <p id="windSpeed">Wind: -- km/h</p>
                </div>
                <div class="agricultural-advice" id="agriculturalAdvice">
                  Agricultural Advice: Loading...
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="form-header">
              <h1>
                <i class="fas fa-seedling"></i>
                Smart Crop Advisor
                <i class="fas fa-leaf"></i>
              </h1>
              <p class="text-center text-light">Optimize Your Agricultural Decisions</p>
            </div>

            <form action="/predict" method="POST">
              <div class="row crop-input-group">
                <div class="col-md-4 mb-3">
                  <label for="Nitrogen" class="form-label">Nitrogen Level</label>
                  <input type="number" id="Nitrogen" name="Nitrogen" class="form-control" placeholder="Enter Nitrogen" required step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="Phosphorus" class="form-label">Phosphorus Level</label>
                  <input type="number" id="Phosporus" name="Phosporus" class="form-control" placeholder="Enter Phosphorus" required step="0.1">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="Potassium" class="form-label">Potassium Level</label>
                  <input type="number" id="Potassium" name="Potassium" class="form-control" placeholder="Enter Potassium" required step="0.1">
                </div>
              </div>

              <div class="row crop-input-group">
                <div class="col-md-3 mb-3">
                  <label for="Temperature" class="form-label">Temperature (°C)</label>
                  <input type="number" id="Temperature" name="Temperature" class="form-control" placeholder="Enter Temperature" required step="0.1">
                </div>
                <div class="col-md-3 mb-3">
                  <label for="Humidity" class="form-label">Humidity (%)</label>
                  <input type="number" id="Humidity" name="Humidity" class="form-control" placeholder="Enter Humidity" required step="0.1">
                </div>
                <div class="col-md-3 mb-3">
                  <label for="Ph" class="form-label">Soil pH</label>
                  <input type="number" id="Ph" name="Ph" class="form-control" placeholder="Enter pH" required step="0.1">
                </div>
                <div class="col-md-3 mb-3">
                  <label for="Rainfall" class="form-label">Rainfall (mm)</label>
                  <input type="number" id="Rainfall" name="Rainfall" class="form-control" placeholder="Enter Rainfall" required step="0.1">
                </div>
              </div>

              <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-chart-line me-2"></i>
                  Get Crop Recommendation
                </button>

				{% if result %}
					<div class="card bg-dark" style="width: 18rem;">
		  			<img src="{{url_for('static', filename='img.jpg')}}" class="card-img-top" alt="...">
		  			<div class="card-body">
          <h5 class="card-title" style="background-color: {{ color if color else '#4CAF50' }}; color: white;">Recommend Crop for cultivation is:</h5>
					<p class="card-text" style="background-color: {{ color }}; color: white; padding: 10px; border-radius: 5px;">
						{{ result }}
					  </p>
		  			</div>
		</div>
	   {% endif %}
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="ai-assistant">
      <button class="ai-button" onclick="toggleChatWindow()">
        <i class="fas fa-robot fa-2x"></i>
      </button>
    </div>

    <div class="ai-chat-window" id="aiChatWindow">
      <div class="ai-chat-header">
        <h4 class="mb-0">AI Agricultural Assistant</h4>
        <button class="btn btn-sm btn-light" onclick="toggleChatWindow()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="ai-chat-body" id="chatBody">
        <div class="ai-message bot">
          Hello! I'm your AI Agricultural Assistant. How can I help you today?
        </div>
      </div>
      <div class="ai-chat-input">
        <input type="text" id="chatInput" placeholder="Ask me about agriculture...">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <script>
      const apiKey = 'AIzaSyClAFzEfz9ctUpVSTmRIT6Bds7_dz9wJ54';
      const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + apiKey;

      let chatbotInstance = null;

      class AdvancedAgriculturalChatbot {
        constructor() {
          this.chatBody = document.getElementById('chatBody');
          this.chatInput = document.getElementById('chatInput');
        }

        init() {
          this.chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
              this.sendMessage();
            }
          });
        }

        async sendMessage() {
          const userMessage = this.chatInput.value.trim();
          if (!userMessage) return;

          this.displayMessage(userMessage, 'user');
          this.chatInput.value = '';

          this.displayTypingIndicator();

          try {
            const response = await this.getBotResponse(userMessage);
            this.displayMessage(response, 'bot');
          } catch (error) {
            console.error('Error fetching bot response:', error);
            this.displayMessage('Sorry, I encountered an error. Please try again later.', 'bot');
          } finally {
            this.removeTypingIndicator();
            this.scrollToBottom();
          }
        }

        async getBotResponse(message) {
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{ text: message }]
              }]
            })
          });

          if (!response.ok) {
            throw new Error('Network response was not ok');
          }

          const data = await response.json();
          console.log('API Response:', data); // Log the API response for debugging
          if (data.candidates && data.candidates.length > 0) {
            return data.candidates[0].content.parts[0].text;
          } else {
            throw new Error('No candidates found in the API response');
          }
        }

        displayMessage(message, type) {
          const messageElement = document.createElement('div');
          messageElement.classList.add('ai-message', type);
          messageElement.textContent = message;
          this.chatBody.appendChild(messageElement);
          this.scrollToBottom();
        }

        displayTypingIndicator() {
          const typingIndicator = document.createElement('div');
          typingIndicator.classList.add('typing-indicator');
          typingIndicator.innerHTML = '<span></span><span></span><span></span>';
          this.chatBody.appendChild(typingIndicator);
          this.scrollToBottom();
        }

        removeTypingIndicator() {
          const typingIndicator = this.chatBody.querySelector('.typing-indicator');
          if (typingIndicator) {
            this.chatBody.removeChild(typingIndicator);
          }
        }

        scrollToBottom() {
          this.chatBody.scrollTop = this.chatBody.scrollHeight;
        }
      }

      function toggleChatWindow() {
        const chatWindow = document.getElementById('aiChatWindow');
        chatWindow.style.display = chatWindow.style.display === 'none' ? 'block' : 'none';
      }

      function sendMessage() {
        if (!chatbotInstance) {
          chatbotInstance = new AdvancedAgriculturalChatbot();
        }
        chatbotInstance.sendMessage();
      }

      document.addEventListener('DOMContentLoaded', () => {
        chatbotInstance = new AdvancedAgriculturalChatbot();
        chatbotInstance.init();
      });

      async function searchWeather() {
        const city = document.getElementById('citySearch').value;
        if (!city) {
          alert('Please enter a city name.');
          return;
        }

        const apiKey = '24b13d0c2c844a92b3b183105250903';
        const apiUrl = `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city}`;

        try {
          const response = await fetch(apiUrl);
          const data = await response.json();

          if (response.ok) {
            document.getElementById('locationName').textContent = `${data.location.name}, ${data.location.country}`;
            document.getElementById('temperature').textContent = `Temperature: ${data.current.temp_c} °C`;
            document.getElementById('weatherCondition').textContent = `Condition: ${data.current.condition.text}`;
            document.getElementById('humidity').textContent = `Humidity: ${data.current.humidity}%`;
            document.getElementById('windSpeed').textContent = `Wind: ${data.current.wind_kph} km/h`;
            document.getElementById('agriculturalAdvice').textContent = 'Agricultural Advice: Based on current weather conditions, consider appropriate farming practices.';
          } else {
            alert('Error fetching weather data. Please try again.');
          }
        } catch (error) {
          console.error('Error fetching weather data:', error);
          alert('Error fetching weather data. Please try again.');
        }
      }
    </script>
  </body>
</html>
